<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" />
    <meta charset="utf-8" />

    <title>Mahjong, using standard HTML, CSS, and JavaScript</title>

    <!-- page CSS -->
    <link rel="stylesheet" href="src/css/page.css" />
    <link rel="stylesheet" href="src/css/modal.css" />

    <!-- client UI CSS -->
    <link rel="stylesheet" href="src/css/board.css" />
    <link rel="stylesheet" href="src/css/tiles.css" />
    <link rel="stylesheet" href="src/css/discards.css" />
    <link rel="stylesheet" href="src/css/rotator.css" />
    <link rel="stylesheet" href="src/css/players.css" />
    <link rel="stylesheet" href="src/css/tracking.css" />
    <link rel="stylesheet" href="src/css/animations.css" />
  </head>

  <body>
    <main class="board">
      <div class="players">
        <div class="player" id="0" data-wincount="0" data-score="2000"></div>
        <div class="player" id="1" data-wincount="0" data-score="2000"></div>
        <div class="player" id="2" data-wincount="0" data-score="2000"></div>
        <div class="player" id="3" data-wincount="0" data-score="2000"></div>
      </div>

      <div class="wall data"></div>
      <div class="discards"></div>
      <div class="knowledge"></div>

      <div class="windicator">
        <div class="player-wind tc e">西</div>
        <div class="player-wind rc">南</div>
        <div class="player-wind bc">東</div>
        <div class="player-wind lc">北</div>
        <div class="wind-of-the-round">東　南　西　北</div>
        <div class="hand-counter"></div>
      </div>

      <div class="hidden modal"><div class="panel"></div></div>
    </main>

    <section id="explanation">
      <h1>The how of Mahjong</h1>

      <p>
        Mahjong is a four player tile game where players compete to form a
        winning "hand" of 14 tiles, arranged (in general) as four triplets
        (either consecutive tiles within the same suit, or genuine triplets with
        the same tile three times), and a pair (one tile, twice).
      </p>

      <p>
        The traditional game uses 144 tiles, consisting of three numbered suits,
        seven types of "honour" tile, and two sets of bonus tiles. Specifically:
      </p>

      <ul>
        <li>
          <p>
            4x Numerical tiles 1 through 9 with "dots" ornamentation<br />(traditionally
            called 筒, "coin").
          </p>
          <div>
            <img src="https://pomax.github.io/MJJS/public/tiles/18.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/19.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/20.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/21.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/22.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/23.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/24.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/25.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/26.jpg" />
          </div>
        </li>
        <li>
          <p>
            4x Numerical tiles 1 through 9 with "bamboo"/"sticks"
            ornamentation<br />(traditionally called 索, "coin string")
          </p>
          <div>
            <img src="https://pomax.github.io/MJJS/public/tiles/0.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/1.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/2.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/3.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/4.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/5.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/6.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/7.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/8.jpg" />
          </div>
        </li>
        <li>
          <p>
            4x Numerical tiles 1 through 9 with "Chinese character"
            ornamentation<br />(traditionally called 萬, "10,000")
          </p>
          <div>
            <img src="https://pomax.github.io/MJJS/public/tiles/9.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/10.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/11.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/12.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/13.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/14.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/15.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/16.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/17.jpg" />
          </div>
        </li>
        <li>
          <p>
            4x The four cardinal directions (labelled E,S,N,W or 東,南,北,西)
          </p>
          <div>
            <img src="https://pomax.github.io/MJJS/public/tiles/27.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/28.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/29.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/30.jpg" />
          </div>
        </li>
        <li>
          <p>
            4x Three "dragons", (labelled F,C,P or 發,中,▯ called "green",
            "red", and "white" dragon after the colors used for the character on
            each of these tiles)
          </p>
          <div>
            <img src="https://pomax.github.io/MJJS/public/tiles/31.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/32.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/33.jpg" />
          </div>
        </li>
      </ul>

      <p>
        With eight bonus tiles (not part of play - they are set aside
        immediately when drawn, with a new tile is drawn to replace it):
      </p>

      <ul>
        <li>
          <p>
            The four seasons (spring, summer, fall, winter, or 春, 夏, 秋, 冬)
          </p>
          <div>
            <img src="https://pomax.github.io/MJJS/public/tiles/38.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/39.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/40.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/41.jpg" />
          </div>
        </li>
        <li>
          <p>
            The four seasonal flowers (orchid, plum blossom, bamboo,
            chrysanthenum, or 蘭, 梅, 竹, 菊)
          </p>
          <div>
            <img src="https://pomax.github.io/MJJS/public/tiles/34.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/35.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/36.jpg" />
            <img src="https://pomax.github.io/MJJS/public/tiles/37.jpg" />
          </div>
        </li>
      </ul>
    </section>

    <section id="gameplay">
      <h2>Game play</h2>

      <p>
        Core game play is about as simple as it gets: everyone starts with 13
        tiles, and players take turns in which they draw a tile from the pile of
        undealt tiles, check to see if they can form a winning, 14 tile pattern,
        and if not, discard one of their tiles so they're back at 13, after
        which it is the next player's turn.
      </p>

      <p>
        The "actual game" part, rather than "random chance" aspect comes in the
        form of "claims", where players may claim a tile as it is being
        discarded if they can use that tile to form certain sets. In this case,
        it immediately becomes their turn, irrespective of whose turn it
        "should" have been, and rather than drawing a tile from the undealt
        tiles, they take the discarded tile as their 14<sup>th</sup> tile.
      </p>
    </section>

    <section id="rules">
      <h2>Rules around claiming discards</h2>

      <ul>
        <li>
          if a player has two identical tiles in their hand, they may claim a
          third tile when another player discards it.
        </li>
        <li>
          if a player has three identical tiles in their hand, they may claim
          the fourth tile when another player discards it.
        </li>
        <li>
          if a player is waiting for a specific tile to win, they may claim that
          winning tile when another player discards it regardless of what the
          tile is needed for and whether that would be a legal claim if the
          player were not winning on it.
        </li>
      </ul>

      <p>
        If none of the above claims are made, then the player whose turn it is
        next is allowed to pick up the discard tile rather than drawing a tile
        from the undealt tiles, in order to form a set consisting of three
        consecutive numbers within the same suit. Note that these sets are
        typically worth no points, and will typically even negatively impact the
        hand score by ruling out scores based on true-set hand patterns.
      </p>

      <p>
        In the case when a tile has claims by multiple players, a winning claims
        trump any other claims, and a real claim trumps a player wishing to form
        a set of consecutive tiles.
      </p>

      <p>
        When honouring a claim, the receiving player <strong>must</strong>
        reveal all tiles in the set they formed, and put those tiles aside,
        face-up. These tiles are considered "locked", and can no longer be used
        for anything, with a single exception:
      </p>

      <p>
        If a player has a locked, true set of three tiles already on the table,
        and they draw (not claim) the fourth tile, they are allowed to add that
        tile to their locked set of three, forming a locked set of four. If a
        player elects to do this, they receive a new tile from the undealt set
        of tiles to compensate for the "loss" of a tile. If a player forgets to
        do this, they they will not have enough tiles left to form a winning
        hand, and may even be penalized for playing a hand with the wrong number
        of tiles.
      </p>

      <h2>Rule clarifications</h2>

      <p>
        A player is <em>not required</em> to declare sets if they do not need to
        claim a tile for them. If a player has a set of three or four tiles in
        their hand, due to having started the game with them, or having drawn
        tiles over a number of turns to end up with them in hand, they are under
        no obligation to reveal that fact. Winning with unrevealed tiles
        typically incurs a bonus.
      </p>

      <p>
        Note that there are special considerations when a player has four of the
        same tile in their hand. They may declare this and lock the four tiles
        as a set that is no longer in their hand, receiving an extra tile to
        prevent them from having too few tiles to form a winning hand (revealing
        the tiles depending on the exact rules being played. Some rules do not
        require this kind of set to be revealed, meaning other players will not
        know which tile has become unavailable, and so may try to win on a tile
        that cannot ever appear during that round of play). They may also elect
        to keep all four tiles in their hand so that three of the tiles can be
        used as one set, and the fourth tile can be used to form a numerical
        set. Note that because a winning hand has to consist of four sets and a
        pair, a player who wishes to count all four tiles as a single set will
        <em>have</em> to declare that set, or they will not have enough tiles
        with which to form the necessary number of sets and pair.
      </p>
    </section>

    <section id="scoring">
      <h2>Scoring</h2>

      <p>
        Scoring of hands is entirely dependent on the style of mahjong played,
        but can be split into two ways to count points:
      </p>

      <ul>
        <li>
          <em>points and doublings</em>, in which players gain points for
          individual sets, and score doublings for particular combinations of
          sets. Typically this scoring system has an "upper limit", limiting how
          many points players can score per hand.
        </li>
        <li>
          <em>faan</em>, in which player's hands are assigned a "hand score"
          based on specific sets and patterns of sets, and this hand score is
          then translated into a player score based on a rule-dependent mapping.
          Typically this scoring system has both an upper limit, to fix how many
          points players can score per hand, as well as a "lower limit", in
          which getting a higher hand score does not alter the resulting player
          score for several steps. E.g. a hand worth 5 or 6 faan may both score
          as 5 faan, with a hand worth 7 faan assigned a higher score.
        </li>
      </ul>

      <p>
        Additionally, rules typically use one of two "score settling" methods:
      </p>

      <ul>
        <li>
          Winner takes all, in which the winner is paid their player score by
          the other players. In this system, winning is more important than
          forming high scoring hand patterns.
        </li>
        <li>
          Everyone pays everyone, in which the winning player is paid their
          score by the other players, and the other players all pay each other
          based on the difference in scoring. In this system, forming high
          scoring hand patterns is more important than just winning.
        </li>
      </ul>
    </section>

    <section id="this-game">
      <h2>The game you can play on this page</h2>

      <p>
        The game on this page is played using the Chinese Classical rule set,
        and associated scoring. This means:
      </p>

      <ul>
        <li>scoring is based on points and doubles</li>
        <li>players start with 2000 points</li>
        <li>the losers settle their scores after paying the winner</li>
        <li>East is payed double their winnings, but pays double their losses</li>
        <li>the deal does <em>not</em> pass to the next player if East wins.</li>
      </ul>

      <p>
        Points are awarded to any player for the following (open/concealed):
      </p>

      <ul>
        <li>each bonus tile: 4</li>
        <li>pair of dragons: 2</li>
        <li>pair of own winds: 2</li>
        <li>pair of wind of the round: 2</li>
        <li>pung of simples (numbers 2 through 8): 2/4</li>
        <li>pung of terminals (numbers 1 and 9): 4/8</li>
        <li>pung of winds: 4/8</li>
        <li>pung of dragons: 4/8</li>
        <li>kong of simples: 8/16</li>
        <li>kong of terminals: 16/32</li>
        <li>kong of winds: 16/32</li>
        <li>kong of dragonss: 16/32</li>
      </ul>

      <p>
        The following points are awarded to the winner only:
      </p>

      <ul>
        <li>self-drawn win: 2</li>
        <li>winning on a non-scoring pair: 2</li>
        <li>winning on a scoring pair: 4</li>
      </ul>

      <p>
        The following doubles are awarded to any player:
      </p>

      <ul>
        <li>having your own flower and season: 1</li>
        <li>having all flowers: +1</li>
        <li>having all seasons: +1</li>
        <li>pung/kong of own wind: 1</li>
        <li>pung/kong of wind of the round: 1</li>
        <li>pung/kong of dragins: 1</li>
      </ul>

      <p>
        The following doubles are awarded to the winner only:
      </p>

      <ul>
        <li>chow hand (four chows and a non-scoring pair): 1</li>
        <li>tiles from one suit and honours: 1</li>
        <li>only tiles from a single suit: 3</li>
        <li>all pung hand: 1</li>
        <li>fully concealed (and self drawn) hand: 1</li>
        <li>(self-drawn) win on the last tile from the wall</li>
        <li>claimed win on the last discard</li>
      </ul>

      <p>
        The following limit hands (scoring a flat 1000 points) exist:
      </p>

      <ul>
        <li>fully concealed pung hand</li>
        <li>all terminals: pungs and pairs of only 1 and 9 tiles</li>
        <li>all honours: pungs and pairs of winds and dragons</li>
        <li>all kong: four kongs and a pair</li>
        <li>three great scholars: pung/kong of each dragon</li>
        <li>little four winds: pung/kong of three winds, pair of last wind</li>
        <li>big four winds: pung/kong of all winds</li>
      </ul>

      <p>
        The player winds rotate counter-clockwise, so that (E,S,W,N) become
        (S,W,N,E), and the wind of the round rotates clockwise, starting at
        East, then South, then West, then North.
      </p>
    </section>

    <section id="scripts" class="hidden">
      <script src="src/js/core/utils/prng.js"></script>
      <script src="src/config.js"></script>
      <script src="src/js/core/utils/utils.js"></script>
      <script src="src/js/page/modal.js"></script>
      <script src="src/js/core/wall.js"></script>
      <script src="src/js/core/players/tracking/tile-tracker.js"></script>
      <script src="src/js/core/players/ui/client-ui.js"></script>
      <script src="src/js/core/players/ui/rotator.js"></script>
      <script src="src/js/core/players/player.js"></script>
      <script src="src/js/core/players/bot.js"></script>
      <script src="src/js/core/players/human.js"></script>
      <script src="src/js/core/algorithm/pattern.js"></script>
      <script src="src/js/core/algorithm/tiles-needed.js"></script>
      <script src="src/js/core/scoring/ruleset.js"></script>
      <script src="src/js/core/scoring/chinese-classical.js"></script>
      <script src="src/js/core/game.js"></script>
      <script src="src/js/core/game-manager.js"></script>
      <!-- twitter the sparrows! -->
      <script src="src/js/page/play-or-watch.js"></script>
    </section>

    <footer>
      Page by <a href="https://twitter.com/TheRealPomax">Pomax</a>, project page
      over on
      <a href="https://github.com/Pomax/mj">https://github.com/Pomax/mj</a>
    </footer>
  </body>
</html>
